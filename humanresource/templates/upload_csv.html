{% extends 'base.html'%}
{% load static %}
{% block content %}

<h2>ðŸ“‚ Payroll CSV Uploader</h2>

{% for message in messages %}
    <div class="message {{ message.tags }}" style="padding: 10px; margin-bottom: 15px; border: 1px solid; background-color: 
        {% if message.tags == 'success' %}#d4edda; border-color: #c3e6cb; color: #155724; 
        {% elif message.tags == 'error' %}#f8d7da; border-color: #f5c6cb; color: #721c24; 
        {% else %}#fff3cd; border-color: #ffc720; color: #664d03;{% endif %}">
        {{ message }}
    </div>
{% endfor %}

<div class="upload-section">
    <h3>Upload File</h3>
    <form method="POST" enctype="multipart/form-data" action="{% url 'humanresource:payroll_upload'%}"> 
        {% csrf_token%}
        <label for="id_file">Select CSV File:</label>
        <input type="file" id="id_file" name="payroll_file" accept=".csv" required>
        
        <button type="submit" style="margin-top: 10px;">Upload & Process Payroll</button>
    </form>
</div>

<hr>

<div class="history-section">
    {% if history %}
        <table>
       
            <tbody>
          
            <div class="history-section">
Â  Â  <h3>ðŸ•’ Upload History</h3>
Â  Â  {% if history %}
Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Date/Time</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>File Name</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Uploaded By</th>
                    <th>Action</th> Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  {% for item in history %}
Â  Â  Â  Â  Â  Â  Â  Â  <tr style="background-color: {% if item.status == 'Success' %}#e6ffe6{% else %}#ffe6e6{% endif %};">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.upload_time|date:"Y-m-d H:i" }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.file_name }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.uploaded_by }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
                    
                    <td>
                        <form method="POST" action="{% url 'humanresource:payroll_delete' upload_id=item.id %}" onsubmit="return confirm('Are you sure you want to delete the payroll data for {{ item.file_name }}? This action is irreversible.');">
                            {% csrf_token %}
                            <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer;">Delete</button>
                        </form>
                    </td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  {% else %}
Â  Â  Â  Â  <p>No upload history found.</p>
Â  Â  {% endif %}
</div>


            </tbody>
        </table>
    {% else %}
        <p>No upload history found.</p>
    {% endif %}
</div>

{% endblock %}