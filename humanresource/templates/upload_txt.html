{% extends 'base.html'%}
{% load static %}
{% block content %}

<h2>ğŸ“‚ Payroll TXT Uploader</h2>

{% for message in messages %}
Â  Â  <div class="message {{ message.tags }}" style="padding: 10px; margin-bottom: 15px; border: 1px solid; background-color: 
Â  Â  Â  Â  {% if message.tags == 'success' %}#d4edda; border-color: #c3e6cb; color: #155724; 
Â  Â  Â  Â  {% elif message.tags == 'error' %}#f8d7da; border-color: #f5c6cb; color: #721c24; 
Â  Â  Â  Â  {% else %}#fff3cd; border-color: #ffc720; color: #664d03;{% endif %}">
Â  Â  Â  Â  {{ message }}
Â  Â  </div>
{% endfor %}

<div class="upload-section">
Â  Â  <h3>Upload File</h3>
Â  Â  <form method="POST" enctype="multipart/form-data" action="{% url 'humanresource:payroll_upload'%}"> 
Â  Â  Â  Â  {% csrf_token%}
Â  Â  Â  Â  <label for="id_file">Select TXT File:</label>
Â  Â  Â  Â  <input type="file" id="id_file" name="payroll_file" accept=".txt" required>
Â  Â  Â  Â  
Â  Â  Â  Â  <button type="submit" style="margin-top: 10px;">Upload & Process Payroll</button>
Â  Â  </form>
</div>

<hr>

<div class="history-section">
Â  Â  <h3>ğŸ•’ Upload History</h3>
Â  Â  {% if history %}
Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Date/Time</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>File Name</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Uploaded By</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Action</th> 
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  {% for item in history %}
Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.upload_time|date:"Y-m-d H:i" }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.filename }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.uploaded_by }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
                        <form method="POST" action="{% url 'humanresource:delete_history' item.id %}" onsubmit="return confirm('Are you sure you want to delete the history for {{ item.filename }}? (This also deletes all associated payroll data!)');">
                            {% csrf_token %}
                            <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer;">
                                ğŸ—‘ï¸ Delete
                            </button>
                        </form>
                    </td>
Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  {% else %}
Â  Â  Â  Â  <p>No upload history found.</p>
Â  Â  {% endif %}
</div>

<hr>

<div class="employee-list-section">
    <h3>ğŸ‘¤ Processed Employees (Chronological Order)</h3>
    
    <form method="GET" action="{% url 'humanresource:search_employee'%}" style="margin-bottom: 15px;">
        <input type="text" name="query" placeholder="Search by ID or Name" required 
               style="padding: 5px; border: 1px solid #ccc; border-radius: 3px; width: 250px;">
        <button type="submit" 
                style="background-color: #28a745; color: white; border: none; padding: 6px 10px; cursor: pointer; border-radius: 3px;">
            ğŸ” Search Employee
        </button>
    </form>
    {% if unique_employees %}
        <table>
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th>Employee ID</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in unique_employees %}
                    <tr>
                        <td><strong>{{ employee.employee_name }}</strong></td>
                        <td>{{ employee.employee_id }}</td>
                        <td>
                            <a href="{% url 'humanresource:view_employee_details' employee.employee_id %}" 
                               style="background-color: #007bff; color: white; padding: 5px 10px; text-decoration: none; border-radius: 3px;">
                                View All Logs
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No employee records have been processed yet.</p>
    {% endif %}
</div>

{% endblock %}