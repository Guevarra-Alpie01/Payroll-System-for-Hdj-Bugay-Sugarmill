{% extends 'base.html'%}
{% load static %}
{% block content %}

<style>
    /* Add basic styling to initially hide the history block */
    #history-content {
        display: none;
        margin-top: 15px; /* Add some spacing above the table/message */
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }
    
    /* Style for the toggle button */
    #toggle-history-btn {
        background-color: #6c757d; /* Grey button */
        color: white;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 4px;
        font-weight: bold;
        transition: background-color 0.3s;
    }

    #toggle-history-btn:hover {
        background-color: #5a6268;
    }
</style>

<h2>ğŸ“‚ Payroll TXT Uploader</h2>

{% for message in messages %}
Â  Â  <div class="message {{ message.tags }}" style="padding: 10px; margin-bottom: 15px; border: 1px solid; background-color: 
Â  Â  Â  Â  {% if message.tags == 'success' %}#d4edda; border-color: #c3e6cb; color: #155724; 
Â  Â  Â  Â  {% elif message.tags == 'error' %}#f8d7da; border-color: #f5c6cb; color: #721c24; 
Â  Â  Â  Â  {% else %}#fff3cd; border-color: #ffc720; color: #664d03;{% endif %}">
Â  Â  Â  Â  {{ message }}
Â  Â  </div>
{% endfor %}

<div class="upload-section">
Â  Â  <h3>Upload File</h3>
Â  Â  <form method="POST" enctype="multipart/form-data" action="{% url 'humanresource:payroll_upload'%}"> 
Â  Â  Â  Â  {% csrf_token%}
Â  Â  Â  Â  <label for="id_file">Select TXT File:</label>
Â  Â  Â  Â  <input type="file" id="id_file" name="payroll_file" accept=".txt" required>
Â  Â  Â  Â  
Â  Â  Â  Â  <button type="submit" style="margin-top: 10px;">Upload & Process Payroll</button>
Â  Â  </form>
</div>

<hr>

<div class="history-section">
    <button id="toggle-history-btn" aria-expanded="false" aria-controls="history-content">
        â• Show Upload History
    </button>
    

    <div id="history-content">
        <h3>ğŸ•’ Upload History</h3>
        {% if history %}
    Â  Â  Â  Â  <table>
    Â  Â  Â  Â  Â  Â  <thead>
    Â  Â  Â  Â  Â  Â  Â  Â  <tr>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Date/Time</th>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>File Name</th>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Uploaded By</th>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Action</th> 
    Â  Â  Â  Â  Â  Â  Â  Â  </tr>
    Â  Â  Â  Â  Â  Â  </thead>
    Â  Â  Â  Â  Â  Â  <tbody>
    Â  Â  Â  Â  Â  Â  {% for item in history %}
    Â  Â  Â  Â  Â  Â  Â  Â  <tr>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.upload_time|date:"Y-m-d H:i" }}</td>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.filename }}</td>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>{{ item.uploaded_by }}</td>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form method="POST" action="{% url 'humanresource:delete_history' item.id %}" onsubmit="return confirm('Are you sure you want to delete the history for {{ item.filename }}? (This also deletes all associated payroll data!)');">
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% csrf_token %}
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer;">
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ—‘ï¸ Delete
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
    Â  Â  Â  Â  Â  Â  Â  Â  </tr>
    Â  Â  Â  Â  Â  Â  {% endfor %}
    Â  Â  Â  Â  Â  Â  </tbody>
    Â  Â  Â  Â  </table>
    Â  Â  {% else %}
    Â  Â  Â  Â  <p>No upload history found.</p>
    Â  Â  {% endif %}
    </div>
</div>
<script src="{% static 'js/upload_txt.js' %}"></script>
<hr>




{% endblock %}